Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _jsxFileName='./src/itemListContainer.js';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactNative=require('react-native');var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);var _item=require('./item');var _item2=_interopRequireDefault(_item);var _style=require('./style');var _style2=_interopRequireDefault(_style);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var SubmitButton=function SubmitButton(_ref){var customStyles=_ref.customStyles,disableBtn=_ref.disableBtn,extraBtnOpacityProps=_ref.extraBtnOpacityProps,floatSubmitBtn=_ref.floatSubmitBtn,onSubmit=_ref.onSubmit,selectedItem=_ref.selectedItem,submitBtnTitle=_ref.submitBtnTitle,multiselect=_ref.multiselect,submitBtnWidth=_ref.submitBtnWidth;var btn=customStyles.btn,btnOpacity=customStyles.btnOpacity,btnTxt=customStyles.btnTxt,disabledBtnOpacity=customStyles.disabledBtnOpacity,disabledBtn=customStyles.disabledBtn,disabledBtnTxt=customStyles.disabledBtnTxt;var buttonText=_style2.default.buttonText,buttonView=_style2.default.buttonView,submitOpacity=_style2.default.submitOpacity;var opacityStyle=[submitOpacity,floatSubmitBtn&&{position:'absolute'},disableBtn&&_extends({opacity:0.7},disabledBtnOpacity),submitBtnWidth&&{marginHorizontal:(100-submitBtnWidth)/2+'%'},btnOpacity];var submitFunc=onSubmit||function(){};var submitItem=selectedItem;if(multiselect)submitItem=selectedItem&&selectedItem.map(function(obj){return obj.item;});return _react2.default.createElement(_reactNative.TouchableOpacity,_extends({disabled:disableBtn,onPress:function onPress(){submitFunc(submitItem);},style:opacityStyle},extraBtnOpacityProps,{__source:{fileName:_jsxFileName,lineNumber:31}}),_react2.default.createElement(_reactNative.View,{style:[buttonView,btn,disableBtn?disabledBtn:{}],__source:{fileName:_jsxFileName,lineNumber:37}},_react2.default.createElement(_reactNative.Text,{style:[buttonText,btnTxt,disableBtn?disabledBtnTxt:{}],__source:{fileName:_jsxFileName,lineNumber:38}},submitBtnTitle)));};var ReactNativeItemSelect=function(_Component){_inherits(ReactNativeItemSelect,_Component);_createClass(ReactNativeItemSelect,null,[{key:'isDisabled',value:function isDisabled(selectedItem,multiselect,minSelectCount){return multiselect&&selectedItem&&selectedItem.length<minSelectCount||!selectedItem;}}]);function ReactNativeItemSelect(props){_classCallCheck(this,ReactNativeItemSelect);var _this=_possibleConstructorReturn(this,(ReactNativeItemSelect.__proto__||Object.getPrototypeOf(ReactNativeItemSelect)).call(this,props));var data=props.data,countPerRow=props.countPerRow;var multiselect=props.multiselect;_this.state={formattedData:ReactNativeItemSelect.getChunks(data||[],countPerRow),indexMapping:{},selectedItem:multiselect&&[]};_this.onSelect=_this.onSelect.bind(_this);return _this;}_createClass(ReactNativeItemSelect,[{key:'componentDidMount',value:function componentDidMount(){var _this2=this;var formattedData=this.state.formattedData;var searchKey=this.props.searchKey;formattedData.forEach(function(chunkData,index){chunkData.forEach(function(item,chunkIndex){if(item.selected){var mapKey=searchKey?item[searchKey]:index+'_'+chunkIndex;_this2.onSelect(mapKey,false,item);}});});}},{key:'componentDidUpdate',value:function componentDidUpdate(prevProps){var _props=this.props,searchKey=_props.searchKey,data=_props.data,countPerRow=_props.countPerRow;var prevData=prevProps.data;if(searchKey&&data.length!==prevData.length){this.setState({formattedData:ReactNativeItemSelect.getChunks(data||[],countPerRow)});}}},{key:'onSelect',value:function onSelect(index,selected,item){var newState=_extends({},this.state);var indexMapping=newState.indexMapping,selectedItem=newState.selectedItem;var tempSelected=selectedItem;var _props2=this.props,multiselect=_props2.multiselect,maxSelectAlertTxt=_props2.maxSelectAlertTxt,maxSelectCount=_props2.maxSelectCount;if(multiselect&&selectedItem.length===maxSelectCount&&!selected){return _reactNative.Alert.alert('',maxSelectAlertTxt||'You can\'t select more than '+maxSelectCount+' items');}if(!multiselect)Object.keys(indexMapping).forEach(function(i){indexMapping[i]=false;});indexMapping[index]=!selected;if(multiselect){if(selected)tempSelected=tempSelected.filter(function(obj){return obj.index!==index;});else tempSelected.push({index:index,item:item});}else{tempSelected=selected?null:item;}newState.selectedItem=tempSelected;return this.setState(newState);}},{key:'render',value:function render(){var _this3=this;var isDisabled=ReactNativeItemSelect.isDisabled;var _props3=this.props,customStyles=_props3.styles,data=_props3.data,onSubmit=_props3.onSubmit,floatSubmitBtn=_props3.floatSubmitBtn,submitBtnTitle=_props3.submitBtnTitle,searchKey=_props3.searchKey,multiselect=_props3.multiselect,minSelectCount=_props3.minSelectCount,lastRowMargin=_props3.lastRowMargin,submitBtnWidth=_props3.submitBtnWidth,extraBtnOpacityProps=_props3.extraBtnOpacityProps,itemComponent=_props3.itemComponent;var _state=this.state,selectedItem=_state.selectedItem,formattedData=_state.formattedData;var container=_style2.default.container,itemWrapper=_style2.default.itemWrapper;var rowWrapper=customStyles.rowWrapper;var submitBtnProps={customStyles:customStyles,extraBtnOpacityProps:extraBtnOpacityProps,multiselect:multiselect,floatSubmitBtn:floatSubmitBtn,onSubmit:onSubmit,selectedItem:selectedItem,submitBtnTitle:submitBtnTitle,submitBtnWidth:submitBtnWidth};var renderSubmitBtn=function renderSubmitBtn(){return _react2.default.createElement(SubmitButton,_extends({disableBtn:isDisabled(selectedItem,multiselect,minSelectCount)},submitBtnProps,{__source:{fileName:_jsxFileName,lineNumber:149}}));};var extraMargin={};return _react2.default.createElement(_reactNative.View,{style:container,__source:{fileName:_jsxFileName,lineNumber:157}},_react2.default.createElement(_reactNative.ScrollView,{style:container,__source:{fileName:_jsxFileName,lineNumber:158}},_react2.default.createElement(_reactNative.View,{style:container,__source:{fileName:_jsxFileName,lineNumber:159}},formattedData.map(function(chunkData,index){var isLast=formattedData.length===index+1;if(floatSubmitBtn&&isLast){extraMargin={marginBottom:lastRowMargin};}return _react2.default.createElement(_reactNative.View,{key:String(index),style:[itemWrapper,extraMargin,rowWrapper],__source:{fileName:_jsxFileName,lineNumber:169}},chunkData.map(function(item,chunkIndex){var mapKey=searchKey?item[searchKey]:index+'_'+chunkIndex;var isSelected=_this3.state.indexMapping[mapKey];return _react2.default.createElement(_item2.default,_extends({index:mapKey,onSelect:_this3.onSelect,key:String(chunkIndex),selected:isSelected,item:item},_this3.props,{__source:{fileName:_jsxFileName,lineNumber:178}}));}));})),data&&itemComponent&&!floatSubmitBtn&&renderSubmitBtn()),data&&itemComponent&&floatSubmitBtn&&renderSubmitBtn());}}],[{key:'getChunks',value:function getChunks(data,chunk){var i=void 0;var j=void 0;var tempArray=[];for(i=0,j=data.length;i<j;i+=chunk){tempArray.push(data.slice(i,i+chunk));}return tempArray;}}]);return ReactNativeItemSelect;}(_react.Component);ReactNativeItemSelect.propTypes={data:_propTypes2.default.instanceOf(Array).isRequired,itemComponent:_propTypes2.default.func.isRequired,onSubmit:_propTypes2.default.func.isRequired,countPerRow:_propTypes2.default.number,extraItemHighlighProps:_propTypes2.default.instanceOf(Object),extraBtnOpacityProps:_propTypes2.default.instanceOf(Object),floatSubmitBtn:_propTypes2.default.bool,lastRowMargin:_propTypes2.default.number,maxSelectAlertTxt:_propTypes2.default.string,maxSelectCount:_propTypes2.default.number,minSelectCount:_propTypes2.default.number,multiselect:_propTypes2.default.bool,styles:_propTypes2.default.shape({btn:_propTypes2.default.instanceOf(Object),disabledBtn:_propTypes2.default.instanceOf(Object),btnOpacity:_propTypes2.default.instanceOf(Object),disabledBtnOpacity:_propTypes2.default.instanceOf(Object),btnTxt:_propTypes2.default.instanceOf(Object),disabledBtnTxt:_propTypes2.default.instanceOf(Object),itemBoxHighlight:_propTypes2.default.instanceOf(Object),activeItemBoxHighlight:_propTypes2.default.instanceOf(Object),itemComponentWrapper:_propTypes2.default.instanceOf(Object),tickTxt:_propTypes2.default.instanceOf(Object),rowWrapper:_propTypes2.default.instanceOf(Object)}),searchKey:_propTypes2.default.string,submitBtnTitle:_propTypes2.default.string,submitBtnWidth:_propTypes2.default.number,tickPosition:_propTypes2.default.oneOf(['topLeft','topRight','topMiddle','bottomLeft','bottomRight','bottomMiddle','middle','leftMiddle','rightMiddle']),tickStyle:_propTypes2.default.oneOf(['check','overlayCheck']),tickTxt:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.instanceOf(Object)]),tickComponent:_propTypes2.default.node};ReactNativeItemSelect.defaultProps={countPerRow:2,extraItemHighlighProps:{},extraBtnOpacityProps:{},floatSubmitBtn:false,lastRowMargin:50,maxSelectAlertTxt:null,maxSelectCount:null,minSelectCount:1,multiselect:false,styles:{},searchKey:null,submitBtnTitle:'Submit',submitBtnWidth:100,tickPosition:null,tickStyle:null,tickTxt:_react2.default.createElement(_reactNative.Text,{__source:{fileName:_jsxFileName,lineNumber:267}},'\u2713'),tickComponent:null};exports.default=ReactNativeItemSelect;